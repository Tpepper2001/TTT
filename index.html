<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Traffic Simulator</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; padding: 20px; background: #f0f2f5; color: #1a1a1b; line-height: 1.5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { margin-top: 0; color: #1e3c72; display: flex; align-items: center; gap: 10px; }
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 25px 0; }
        .config-item { display: flex; flex-direction: column; }
        .config-item label { font-weight: 600; margin-bottom: 8px; font-size: 0.85rem; color: #444; text-transform: uppercase; letter-spacing: 0.5px; }
        .config-item input, .config-item select { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: border 0.2s; }
        .config-item input:focus { border-color: #1e3c72; outline: none; box-shadow: 0 0 0 3px rgba(30,60,114,0.1); }
        .config-item.checkbox { flex-direction: row; align-items: center; gap: 12px; cursor: pointer; }
        .config-item.checkbox input { width: 18px; height: 18px; cursor: pointer; }
        .button-group { display: flex; gap: 12px; margin: 25px 0; flex-wrap: wrap; }
        button { padding: 14px 28px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s; font-size: 0.95rem; }
        #startBtn { background: #28a745; color: white; flex: 2; }
        #startBtn:hover { background: #218838; transform: translateY(-1px); }
        #stopBtn { background: #dc3545; color: white; flex: 1; }
        #stopBtn:hover:not(:disabled) { background: #c82333; }
        #testBtn { background: #6c757d; color: white; flex: 1; }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        .logs { background: #1a1a1a; color: #00ff99; padding: 20px; border-radius: 8px; height: 400px; overflow-y: auto; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; margin-top: 25px; border: 1px solid #333; }
        .logs div { margin-bottom: 4px; border-left: 2px solid transparent; padding-left: 8px; }
        .logs .click-log { color: #ffcc00; font-weight: bold; border-left: 2px solid #ffcc00; }
        .logs .err-log { color: #ff5555; }
        .note { background: #fff9e6; border-left: 6px solid #ffcc00; padding: 20px; border-radius: 8px; margin-top: 25px; font-size: 0.9rem; }
        .note strong { color: #856404; }
        code { background: #eee; padding: 2px 5px; border-radius: 4px; font-family: monospace; }
        pre { background: #2d2d2d; color: #ccc; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Traffic Simulator Pro</h1>
        <p>Generates high-quality simulated traffic with randomized browser fingerprints and multi-page engagement behavior.</p>

        <div class="config-grid">
            <div class="config-item">
                <label>üéØ Target Link (Final Destination)</label>
                <input type="url" id="targetLink" value="https://example.com/offer" placeholder="https://...">
            </div>
            <div class="config-item">
                <label>üì° Tracking Endpoint (Your Backend)</label>
                <input type="url" id="trackingEndpoint" value="http://localhost:3000/track" placeholder="https://...">
            </div>
            <div class="config-item">
                <label>üî¢ Number of Sessions</label>
                <input type="number" id="totalVisits" value="50" min="1" max="1000">
            </div>
            <div class="config-item checkbox">
                <input type="checkbox" id="followRedirects" checked>
                <label for="followRedirects">üîÑ Backend: Follow 301/302 Redirects</label>
            </div>
        </div>

        <div class="button-group">
            <button id="startBtn" onclick="runSimulation()">‚ñ∂ Start Simulation</button>
            <button id="stopBtn" onclick="stopSimulation()" disabled>‚èπ Stop</button>
            <button id="testBtn" onclick="testSingleSession()">üß™ Test 1 Session</button>
        </div>

        <div class="logs" id="logs">
            <div style="color: #888;">> System ready. Waiting for start...</div>
        </div>

        <div class="note">
            <strong>‚ö†Ô∏è Cross-Origin Restriction:</strong> Browsers cannot directly follow redirects or bypass CORS for tracking. 
            You must run a small backend script (Node.js, Python, or PHP) that receives the POST request and uses a library like <code>axios</code> or <code>requests</code> to fetch the Target Link and return the final URL.
        </div>

        <hr style="margin: 40px 0; border: 0; border-top: 1px solid #eee;">
        
        <h3>üõ†Ô∏è Suggested Backend (Node.js/Express)</h3>
        <pre>
const express = require('express');
const axios = require('axios');
const cors = require('cors');
const app = express();

app.use(cors()); // Allow the HTML file to talk to this server
app.use(express.json());

app.post('/track', async (req, res) => {
    const { targetLink, fingerprint, type } = req.body;
    try {
        // We simulate the visit from the server to follow redirects
        const response = await axios.get(targetLink, {
            headers: { 'User-Agent': fingerprint.userAgent },
            maxRedirects: 5,
            timeout: 10000
        });
        
        console.log(`[${type}] Visit to: ${targetLink} | Status: ${response.status}`);
        res.json({ success: true, finalUrl: response.request.res.responseUrl });
    } catch (err) {
        res.status(500).json({ error: err.message });
    }
});

app.listen(3000, () => console.log('Backend running on port 3000'));
        </pre>
    </div>

    <script>
        // --- DATA POOLS FOR FINGERPRINTING ---
        const USER_AGENTS = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15',
            'Mozilla/5.0 (iPhone; CPU iPhone OS 17_2_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1'
        ];
        const SCREEN_SIZES = [
            {w: 1920, h: 1080}, {w: 1440, h: 900}, {w: 1536, h: 864}, 
            {w: 1366, h: 768}, {w: 2560, h: 1440}, {w: 390, h: 844}
        ];
        const TIMEZONES = ['America/New_York', 'America/Chicago', 'Europe/London', 'Europe/Paris', 'Asia/Tokyo', 'Australia/Sydney'];
        const PLATFORMS = ['Win32', 'MacIntel', 'Linux x86_64', 'iPhone'];

        // --- STATE ---
        let isRunning = false;
        let stopRequested = false;
        const logsElement = document.getElementById('logs');

        // --- UTILS ---
        function addLog(msg, type = '') {
            const div = document.createElement('div');
            if (type) div.className = type;
            const time = new Date().toLocaleTimeString();
            div.innerText = `[${time}] ${msg}`;
            logsElement.appendChild(div);
            logsElement.scrollTop = logsElement.scrollHeight;
        }

        const sleep = ms => new Promise(res => setTimeout(res, ms));
        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const randomItem = arr => arr[Math.floor(Math.random() * arr.length)];

        function generateFingerprint() {
            const screen = randomItem(SCREEN_SIZES);
            return {
                userAgent: randomItem(USER_AGENTS),
                screenResolution: `${screen.w}x${screen.h}`,
                timezone: randomItem(TIMEZONES),
                platform: randomItem(PLATFORMS),
                language: 'en-US',
                hardwareConcurrency: randomItem([2, 4, 8, 16]),
                deviceMemory: randomItem([4, 8, 16])
            };
        }

        async function sendToBackend(payload) {
            const endpoint = document.getElementById('trackingEndpoint').value;
            try {
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                if (data.finalUrl && data.finalUrl !== payload.targetLink) {
                    addLog(` ‚Ü™Ô∏è Redirect followed to: ${data.finalUrl.substring(0, 50)}...`);
                }
                return true;
            } catch (e) {
                addLog(` ‚ùå Connection Error: ${e.message}`, 'err-log');
                return false;
            }
        }

        // --- SIMULATION LOGIC ---
        async function runSession(id, clickCounter) {
            const fingerprint = generateFingerprint();
            const target = document.getElementById('targetLink').value;
            const follow = document.getElementById('followRedirects').checked;
            
            const pages = randomInt(2, 4);
            addLog(`‚ñ∂ Session ${id} starting (${pages} pages)...`);

            for (let i = 1; i <= pages; i++) {
                if (stopRequested) return;

                addLog(`   üìÑ Viewing page ${i}...`);
                await sendToBackend({
                    type: 'impression',
                    sessionId: id,
                    pageIndex: i,
                    fingerprint,
                    targetLink: target,
                    followRedirects: follow
                });

                // Simulate "User Interaction"
                const dwell = randomInt(3000, 8000);
                await sleep(dwell / 2);
                addLog(`      üñ±Ô∏è Scrolling & mouse movement detected`);
                await sleep(dwell / 2);
            }

            // CTR Calculation (Targets 2%)
            const totalToRun = parseInt(document.getElementById('totalVisits').value);
            const chance = 0.02; 
            
            if (Math.random() < chance) {
                addLog(`üí∞ CLICK EVENT TRIGGERED!`, 'click-log');
                await sendToBackend({
                    type: 'click',
                    sessionId: id,
                    fingerprint,
                    targetLink: target,
                    followRedirects: follow
                });
                clickCounter.val++;
            }
        }

        async function runSimulation() {
            const total = parseInt(document.getElementById('totalVisits').value);
            if (!total || total < 1) return alert("Enter valid session count");

            isRunning = true;
            stopRequested = false;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            logsElement.innerHTML = '';
            addLog(`üöÄ Simulation sequence initiated for ${total} sessions.`);

            let clickCounter = { val: 0 };

            for (let i = 1; i <= total; i++) {
                if (stopRequested) break;
                
                await runSession(i, clickCounter);
                
                if (i < total && !stopRequested) {
                    const wait = randomInt(2000, 10000);
                    addLog(`‚åõ Waiting ${wait}ms for next unique user...`);
                    await sleep(wait);
                }
            }

            addLog(`‚úÖ Simulation Complete. Total Clicks: ${clickCounter.val}`, 'click-log');
            stopSimulation();
        }

        function stopSimulation() {
            stopRequested = true;
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            addLog(`‚èπ Simulation halted.`);
        }

        async function testSingleSession() {
            logsElement.innerHTML = '';
            addLog("üß™ Testing single session bridge...");
            await runSession("TEST", { val: 0 });
            addLog("üß™ Test complete.");
        }
    </script>
</body>
</html>
